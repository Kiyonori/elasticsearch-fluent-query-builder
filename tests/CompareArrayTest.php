<?php

use Kiyonori\ElasticsearchFluentQueryBuilder\CompareArray;

test(
    '2ã¤ã®é…åˆ—ã‚’æ¯”è¼ƒã—ã€å…¨ãåŒã˜ã§ã‚ã‚‹ã“ã¨ã‚’æ„å‘³ã™ã‚‹ã€Œç©ºã£ã½ã®é…åˆ—ã€ãŒè¿”ã£ã¦ãã‚‹ã“ã¨',
    function () {
        $result = app(CompareArray::class)->execute(
            current: [
                'a' => 111,
                'b' => 222,
            ],
            new: [
                'a' => 111,
                'b' => 222,
            ],
        );

        expect($result)->toBe([]);
    }
);

test(
    '2ã¤ã®é…åˆ—ã‚’æ¯”è¼ƒã—ã€å·®ç•°ã®ã‚ã‚‹éƒ¨åˆ†ãŒé…åˆ—ã¨ã—ã¦è¿”ã£ã¦ãã‚‹ã“ã¨',
    function () {
        $result = app(CompareArray::class)->execute(
            current: [
                'a' => 111,
                'b' => 222,
            ],
            new: [
                'a' => 111,
                'b' => 223, // ðŸ‘€ ã“ã“ã«æ³¨ç›®â—ï¸
            ],
        );

        expect($result)->toBe(
            [
                'b' => 223,
            ]
        );
    }
);

test(
    '2ã¤ã®é…åˆ—ã‚’æ¯”è¼ƒã—ã€ï¼„new_å´ã®1éšŽå±¤ç›®ã«æ¬ ã‘ã¦ã„ã‚‹ã‚­ãƒ¼ãŒã‚ã£ã¦ã‚‚ç„¡è¦–ã•ã‚Œã€å·®åˆ†ã¨ã—ã¦æ¤œçŸ¥ã•ã‚Œãªã„ã“ã¨',
    function () {
        $result = app(CompareArray::class)->execute(
            current: [
                'a' => 111,
                'b' => 222,
            ],
            new: [
                'a' => 111,
                // 'b' => 222, // ðŸ‘€ ã“ã“ã«æ³¨ç›®â—ï¸
            ],
        );

        expect($result)->toBe([]);
    }
);

test(
    '2ã¤ã®é…åˆ—ã‚’æ¯”è¼ƒã—ã€ï¼„new_å´ã®1éšŽå±¤ç›®ã«æ–°ã—ã„ã‚­ãƒ¼ãŒã‚ã£ã¦ã‚‚ç„¡è¦–ã•ã‚Œã€å·®åˆ†ã¨ã—ã¦æ¤œçŸ¥ã•ã‚Œãªã„ã“ã¨',
    function () {
        $result = app(CompareArray::class)->execute(
            current: [
                'a' => 111,
                'b' => 222,
            ],
            new: [
                'a' => 111,
                'b' => 222,
                'c' => 333, // ðŸ‘€ ã“ã“ã«æ³¨ç›®â—ï¸
            ],
        );

        expect($result)->toBe([]);
    }
);

test('
    ãƒã‚¹ãƒˆã•ã‚ŒãŸé…åˆ—åŒå£«ã®æ¯”è¼ƒ_ï¼„current_ã¨_ï¼„new_ã®å†…å®¹ãŒã¾ã£ãŸãåŒã˜ã§ã‚ã‚‹å ´åˆã€å…¨ãåŒã˜ã§ã‚ã‚‹ã“ã¨ã‚’æ„å‘³ã™ã‚‹ã€Œç©ºã£ã½ã®é…åˆ—ã€ãŒè¿”ã£ã¦ãã‚‹ã“ã¨',
    function () {
        $result = app(CompareArray::class)->execute(
            current: [
                'a' => 111,
                'b' => [
                    'bb1' => 'ã‚',
                    'bb2' => 'ã‹',
                ],
                'c' => 333,
            ],
            new: [
                'a' => 111,
                'b' => [
                    'bb1' => 'ã‚',
                    'bb2' => 'ã‹',
                ],
                'c' => 333,
            ],
        );

        expect($result)->toBe([]);
    }
);

test(
    'ãƒã‚¹ãƒˆã•ã‚ŒãŸé…åˆ—åŒå£«ã®æ¯”è¼ƒ_ï¼„current_ã¨_ï¼„new_ã®ã†ã¡ç´°éƒ¨ã®_key_ã®ä¸¦ã³é †ãŒ_ï¼„current_å´ã¨ç•°ãªã‚‹å ´åˆã€å·®åˆ†ã¨ã—ã¦1éšŽå±¤ç›®ã®è¦ªã®ã‚­ãƒ¼ã‚’å«ã‚€é…åˆ—ãŒè¿”ã£ã¦ãã‚‹ã“ã¨',
    function () {
        $result = app(CompareArray::class)->execute(
            current: [
                'a' => 111,
                'b' => [
                    'bb1' => 'ã‚',
                    'bb2' => 'ã‹',
                ],
                'c' => 333,
            ],
            new: [
                'a' => 111,
                'b' => [
                    'bb2' => 'ã‹', // ðŸ‘€ ã“ã“ã«æ³¨ç›®â—ï¸
                    'bb1' => 'ã‚', // ðŸ‘€ ã“ã“ã«æ³¨ç›®â—ï¸
                ],
                'c' => 333,
            ],
        );

        expect($result)->toBe(
            [
                'b' => [
                    'bb2' => 'ã‹',
                    'bb1' => 'ã‚',
                ],
            ]
        );
    }
);

test(
    'ãƒã‚¹ãƒˆã•ã‚ŒãŸé…åˆ—åŒå£«ã®æ¯”è¼ƒ_ï¼„new_å´ã®ãƒã‚¹ãƒˆã•ã‚ŒãŸ_key_é …ç›®ãŒ_ï¼„current_å´ã¨æ¯”ã¹ã¦å¤šã„å ´åˆã€å·®åˆ†ã¨ã—ã¦1éšŽå±¤ç›®ã®è¦ªã®ã‚­ãƒ¼ã‚’å«ã‚€é…åˆ—ãŒè¿”ã£ã¦ãã‚‹ã“ã¨',
    function () {
        $result = app(CompareArray::class)->execute(
            current: [
                'a' => 111,
                'b' => [
                    'bb1' => 'ã‚',
                    'bb2' => 'ã‹',
                ],
                'c' => 333,
            ],
            new: [
                'a' => 111,
                'b' => [
                    'bb1' => 'ã‚',
                    'bb2' => 'ã‹',
                    'bb3' => 'ã•', // ðŸ‘€ ã“ã“ã«æ³¨ç›®â—ï¸
                ],
                'c' => 333,
            ],
        );

        expect($result)->toBe(
            [
                'b' => [
                    'bb1' => 'ã‚',
                    'bb2' => 'ã‹',
                    'bb3' => 'ã•',
                ],
            ]
        );
    }
);

test(
    'ãƒã‚¹ãƒˆã•ã‚ŒãŸé…åˆ—åŒå£«ã®æ¯”è¼ƒ_ï¼„new_å´ã®ãƒã‚¹ãƒˆã•ã‚ŒãŸ_key_é …ç›®ãŒ_ï¼„current_å´ã¨æ¯”ã¹ã¦å°‘ãªã„å ´åˆã€å·®åˆ†ã¨ã—ã¦1éšŽå±¤ç›®ã®è¦ªã®ã‚­ãƒ¼ã‚’å«ã‚€é…åˆ—ãŒè¿”ã£ã¦ãã‚‹ã“ã¨',
    function () {
        $result = app(CompareArray::class)->execute(
            current: [
                'a' => 111,
                'b' => [
                    'bb1' => 'ã‚',
                    'bb2' => 'ã‹',
                    'bb3' => 'ã•',
                ],
                'c' => 333,
            ],
            new: [
                'a' => 111,
                'b' => [
                    'bb1' => 'ã‚',
                    // 'bb2' => 'ã‹',// ðŸ‘€ ã“ã“ã«æ³¨ç›®â—ï¸
                    'bb3' => 'ã•',
                ],
                'c' => 333,
            ],
        );

        expect($result)->toBe(
            [
                'b' => [
                    'bb1' => 'ã‚',
                    'bb3' => 'ã•',
                ],
            ]
        );
    }
);

test(
    'ãƒã‚¹ãƒˆã•ã‚ŒãŸé…åˆ—åŒå£«ã®æ¯”è¼ƒï¼»ï¼½å½¢å¼ã®å ´åˆã«ã¦_ï¼„new_å´ã®ãƒã‚¹ãƒˆã•ã‚ŒãŸé …ç›®ãŒ_ï¼„current_å´ã¨æ¯”ã¹ã¦å¤šã„å ´åˆã€å·®åˆ†ã¨ã—ã¦1éšŽå±¤ç›®ã®è¦ªã®ã‚­ãƒ¼ã‚’å«ã‚€é…åˆ—ãŒè¿”ã£ã¦ãã‚‹ã“ã¨',
    function () {
        $result = app(CompareArray::class)->execute(
            current: [
                'a' => 111,
                'b' => [
                    'ã‚ã„ã†ãˆãŠ',
                    'ã‚¢ã‚¤ã‚¦ã‚¨ã‚ª',
                ],
                'c' => 333,
            ],
            new: [
                'a' => 111,
                'b' => [
                    'ã‚ã„ã†ãˆãŠ',
                    'ã‚¢ã‚¤ã‚¦ã‚¨ã‚ª',
                    'ã‹ããã‘ã“', // ðŸ‘€ ã“ã“ã«æ³¨ç›®â—ï¸
                ],
                'c' => 333,
            ],
        );

        expect($result)->toBe(
            [
                'b' => [
                    'ã‚ã„ã†ãˆãŠ',
                    'ã‚¢ã‚¤ã‚¦ã‚¨ã‚ª',
                    'ã‹ããã‘ã“',
                ],
            ]
        );
    }
);

test(
    'ãƒã‚¹ãƒˆã•ã‚ŒãŸé…åˆ—åŒå£«ã®æ¯”è¼ƒ_ï¼»ï¼½å½¢å¼ã®å ´åˆã«ã¦_ï¼„new_å´ã®ãƒã‚¹ãƒˆã•ã‚ŒãŸé …ç›®ãŒ_ï¼„current_å´ã¨æ¯”ã¹ã¦å°‘ãªã„å ´åˆã€å·®åˆ†ã¨ã—ã¦1éšŽå±¤ç›®ã®è¦ªã®ã‚­ãƒ¼ã‚’å«ã‚€é…åˆ—ãŒè¿”ã£ã¦ãã‚‹ã“ã¨',
    function () {
        $result = app(CompareArray::class)->execute(
            current: [
                'a' => 111,
                'b' => [
                    'ã‚ã„ã†ãˆãŠ',
                    'ã‚¢ã‚¤ã‚¦ã‚¨ã‚ª',
                ],
                'c' => 333,
            ],
            new: [
                'a' => 111,
                'b' => [
                    // 'ã‚ã„ã†ãˆãŠ', // ðŸ‘€ ã“ã“ã«æ³¨ç›®â—ï¸
                    'ã‚¢ã‚¤ã‚¦ã‚¨ã‚ª',
                ],
                'c' => 333,
            ],
        );

        expect($result)->toBe(
            [
                'b' => [
                    'ã‚¢ã‚¤ã‚¦ã‚¨ã‚ª',
                ],
            ]
        );
    }
);
